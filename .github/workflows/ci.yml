name: CI

on:
  push:
    branches:
      - main

jobs:
    # upgrade_helm:
    #     name: Upgrade Helm Chart
    #     runs-on: ubuntu-24.04

    #     steps:
    #     - uses: actions/checkout@v4
    #     - name: "Checkout repository"
    #       run: echo "Checking out repository"
    #     - name: "Upgrade Helm Chart"
    #       uses: wahyd4/kubectl-helm-action@master
    #       env:
    #         KUBE_CONFIG_DATA: ${{ secrets.KUBE_CONFIG_DATA }}
    #       with:
    #         args: |
    #             kubectl cluster-info && \
    #             helm upgrade --install wordpress-basic . --wait && \
    #             kubectl rollout status deployment/wordpress-basic
    publish_helm:
        name: Publish Helm Chart
        runs-on: ubuntu-24.04

        steps:
        - name: "Checkout repository"
          uses: actions/checkout@v4

        - name: "Set up Helm"
          uses: azure/setup-helm@v4.2.0

        - name: "Login to Github OCI"
          uses: docker/login-action@v3
          with:
            username: ${{ github.actor }}
            password: ${{ secrets.GITHUB_TOKEN }}
            registry: ghcr.io

        - name: "Package Helm Chart"
          run: |
            helm package .

        - name: "Publish Helm Chart"
          run: |
            helm push *.tgz oci://ghcr.io/${{ github.repository_owner }}/CircleCICDTest
